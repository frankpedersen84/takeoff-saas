<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TakeoffAI | 3D Technology Services</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --gold: #FFB81C;
      --gold-dark: #E5A200;
      --gold-light: #FFD470;
      --teal: #17B2B2;
      --teal-dark: #0E8F8F;
      --teal-light: #4DD4D4;
      --bg-primary: #0A0F1C;
      --bg-secondary: #111827;
      --bg-tertiary: #1F2937;
      --bg-card: #162032;
      --text-primary: #F9FAFB;
      --text-secondary: #9CA3AF;
      --text-muted: #6B7280;
      --border: #374151;
      --success: #10B981;
      --warning: #F59E0B;
      --error: #EF4444;
      --gradient-gold: linear-gradient(135deg, #FFB81C 0%, #FF8C00 100%);
      --gradient-teal: linear-gradient(135deg, #17B2B2 0%, #0891B2 100%);
      --gradient-hero: linear-gradient(135deg, #0A0F1C 0%, #1a1f3c 50%, #0A0F1C 100%);
      --shadow-glow-gold: 0 0 40px rgba(255, 184, 28, 0.3);
      --shadow-glow-teal: 0 0 40px rgba(23, 178, 178, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Animated Background */
    .bg-pattern {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background:
        radial-gradient(ellipse at 20% 20%, rgba(255, 184, 28, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(23, 178, 178, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(255, 184, 28, 0.03) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }

    .grid-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image:
        linear-gradient(rgba(255, 184, 28, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 184, 28, 0.03) 1px, transparent 1px);
      background-size: 50px 50px;
      pointer-events: none;
      z-index: 0;
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-secondary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--teal);
    }

    /* Animations */
    @keyframes float {

      0%,
      100% {
        transform: translateY(0px);
      }

      50% {
        transform: translateY(-10px);
      }
    }

    @keyframes pulse-glow {

      0%,
      100% {
        box-shadow: 0 0 20px rgba(255, 184, 28, 0.3);
      }

      50% {
        box-shadow: 0 0 40px rgba(255, 184, 28, 0.5);
      }
    }

    @keyframes scan-line {
      0% {
        transform: translateY(-100%);
      }

      100% {
        transform: translateY(100vh);
      }
    }

    @keyframes typing {
      from {
        width: 0;
      }

      to {
        width: 100%;
      }
    }

    @keyframes blink {
      50% {
        border-color: transparent;
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    @keyframes shimmer {
      0% {
        background-position: -200% 0;
      }

      100% {
        background-position: 200% 0;
      }
    }

    .animate-fade-in-up {
      animation: fadeInUp 0.6s ease-out forwards;
    }

    .delay-1 {
      animation-delay: 0.1s;
      opacity: 0;
    }

    .delay-2 {
      animation-delay: 0.2s;
      opacity: 0;
    }

    .delay-3 {
      animation-delay: 0.3s;
      opacity: 0;
    }

    .delay-4 {
      animation-delay: 0.4s;
      opacity: 0;
    }

    .delay-5 {
      animation-delay: 0.5s;
      opacity: 0;
    }

    /* Typography */
    .font-mono {
      font-family: 'JetBrains Mono', monospace;
    }

    /* App Container */
    #root {
      position: relative;
      z-index: 1;
    }
  </style>
</head>

<body>
  <div class="bg-pattern"></div>
  <div class="grid-overlay"></div>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    // ============================================
    // AGENT DEFINITIONS WITH MASTER PROMPTS
    // ============================================
    const AGENTS = {
      orchestrator: {
        id: 'orchestrator',
        name: 'Master Orchestrator',
        icon: 'üéØ',
        color: '#FFB81C',
        description: 'Coordinates all agents and manages workflow',
        specialty: 'Project Analysis & Coordination',
        prompt: `You are the Master Orchestrator for 3D Technology Services' TakeoffAI system - an elite project command center that transforms raw construction documents into complete low-voltage system designs and proposals.

You operate as a Senior Principal Estimator with 25+ years of experience across all low-voltage disciplines, combined with the strategic vision of a VP of Operations. Your expertise spans Fire Alarm, Security, CCTV, Access Control, Structured Cabling, Audio/Visual, Nurse Call, Intercom, Paging, and 2-Way Communications systems.

CORE RESPONSIBILITIES:
1. DOCUMENT TRIAGE: Analyze incoming documents to identify project type, building classification, scope of work, jurisdictional requirements, timeline, and bid format.

2. AGENT COORDINATION: Determine which specialist agents to activate, sequence them for dependencies, aggregate outputs, resolve conflicts, and ensure no scope gaps.

3. INTELLIGENCE SYNTHESIS: Cross-reference agent outputs, identify value engineering opportunities, flag risks, recommend alternates.

4. QUALITY ASSURANCE: Verify completeness, check code compliance, validate labor estimates, ensure pricing competitiveness.

For every analysis, provide:
- PROJECT SUMMARY with all key details
- SYSTEMS BREAKDOWN with device counts and estimates
- INTEGRATION MATRIX showing system interfaces
- RISK ASSESSMENT identifying gaps and concerns
- VALUE ENGINEERING opportunities
- RECOMMENDATIONS for clarifications and exclusions`
      },

      fireAlarm: {
        id: 'fireAlarm',
        name: 'Fire Alarm Agent',
        icon: 'üî•',
        color: '#EF4444',
        description: 'NICET Level IV Fire Alarm specialist',
        specialty: 'NFPA 72, Life Safety, Detection & Notification',
        prompt: `You are a NICET Level IV Fire Alarm specialist and licensed Fire Protection Engineer with 20+ years of experience designing fire alarm systems.

EXPERT KNOWLEDGE:
- NFPA 72 (National Fire Alarm and Signaling Code)
- NFPA 70 (NEC) Article 760
- NFPA 101 (Life Safety Code)
- IBC Chapter 9 (Fire Protection Systems)
- ADA requirements for visual notification
- Mass Notification Systems (NFPA 72 Chapter 24)

SYSTEM COMPONENTS:
- FACP: Addressable vs conventional, loop capacity, NAC loading, battery calculations
- Initiating Devices: Smoke, heat, duct, manual stations, waterflow, tamper
- Notification: Horns, strobes, speakers, candela/audibility calculations
- Auxiliary: Elevator recall, HVAC shutdown, door holders, mag lock release

LABOR STANDARDS (hours per device):
- FACP (1-2 loop): 16-24 hrs | FACP (3+ loops): 24-40 hrs
- Smoke/Heat detector: 0.5 hrs | Duct detector: 1.5 hrs
- Pull station: 0.75 hrs | Horn/strobe: 0.75 hrs
- Monitor/Control module: 0.5 hrs
- Wire pull per 100 LF: 0.15-0.3 hrs
- Programming per point: 0.1 hrs | Testing per device: 0.15 hrs

Provide complete material lists with part numbers, quantities, unit costs, and labor hours.`
      },

      dataCabling: {
        id: 'dataCabling',
        name: 'Data/Cabling Agent',
        icon: 'üåê',
        color: '#3B82F6',
        description: 'BICSI RCDD structured cabling expert',
        specialty: 'TIA-568, Infrastructure, Fiber & Copper',
        prompt: `You are a BICSI RCDD (Registered Communications Distribution Designer) with DCDC credentials and 20+ years of experience designing telecommunications infrastructure.

EXPERT KNOWLEDGE:
- ANSI/TIA-568 (Commercial Building Telecommunications Cabling)
- ANSI/TIA-569 (Pathways and Spaces)
- ANSI/TIA-606 (Administration Standard)
- ANSI/TIA-607 (Grounding and Bonding)
- BICSI TDMM
- IEEE 802.3 (Ethernet/PoE standards)

DESIGN STANDARDS:
- Horizontal: Cat5e, Cat6, Cat6A, Cat8 | Max 100m channel
- Backbone: OM3, OM4, OM5 multimode | OS1, OS2 singlemode
- Outlet density: 2 per 100 SF office | 1 per workstation + 20%
- WAP coverage: 2,500-5,000 SF per AP
- TR sizing: 10'x8' minimum, +1 SF per 100 SF served

LABOR STANDARDS (hours):
- Residential outlet pull: 0.75-1.0 hrs | Commercial: 0.5-0.75 hrs
- RJ45 jack termination: 0.1 hrs | Patch panel port: 0.15 hrs
- Fiber connector: 0.25 hrs | Fiber splice: 0.2 hrs
- Copper certification: 0.1 hrs | Fiber certification: 0.15 hrs
- Floor mount rack: 2-4 hrs | Wall mount rack: 1-2 hrs

Provide complete cable schedules, outlet counts, rack layouts, and pathway requirements.`
      },

      cctv: {
        id: 'cctv',
        name: 'CCTV Agent',
        icon: 'üìπ',
        color: '#8B5CF6',
        description: 'PSP certified video surveillance designer',
        specialty: 'IP Cameras, VMS, Storage, Analytics',
        prompt: `You are a PSP (Physical Security Professional) certified video surveillance system designer with expertise in IP-based CCTV systems.

EXPERT KNOWLEDGE:
- Camera technologies: Resolution (2MP-12MP+), sensors, form factors
- Lens selection: Fixed, varifocal, FOV calculations
- PPF requirements: Detection (20-40), Recognition (40-80), Identification (80-120)
- VMS platforms: Milestone, Genetec, Avigilon, Exacq, Camera Station
- Storage calculations: Cameras √ó Bitrate √ó 3600 √ó 24 √ó Days √∑ 8000 = TB
- Network: PoE standards (af/at/bt), bandwidth calculations, VLAN design

DESIGN STANDARDS:
- Entry/exit: 80+ PPF identification
- Parking: 40-60 PPF recognition
- Hallways: 20-40 PPF detection
- Retention: 30 days standard, 90 days financial/gaming

LABOR STANDARDS (hours per device):
- Indoor dome: 1.0-1.5 hrs | Outdoor bullet: 1.5-2.0 hrs
- PTZ: 2.0-3.0 hrs | Multi-sensor: 2.5-3.5 hrs
- Server rack mount: 4-8 hrs | NVR appliance: 2-4 hrs
- Programming per camera: 0.5-1.0 hrs
- VMS server setup: 8-16 hrs
- Testing per camera: 0.25 hrs

Provide camera schedules with models, storage calculations, and network requirements.`
      },

      accessControl: {
        id: 'accessControl',
        name: 'Access Control Agent',
        icon: 'üö™',
        color: '#10B981',
        description: 'CPP certified access control specialist',
        specialty: 'Readers, Controllers, Credentials, Integration',
        prompt: `You are a CPP (Certified Protection Professional) with specialized expertise in electronic access control systems.

EXPERT KNOWLEDGE:
- Architectures: Panel-based, IP-based, cloud, hybrid
- Platforms: Lenel, AMAG, Keyscan, Kantech, Brivo, Openpath
- Credentials: HID Prox (125kHz), iCLASS (13.56MHz), SEOS, mobile, biometric
- Lock hardware: Electric strikes, mag locks, ELR, wireless locks

DOOR CLASSIFICATIONS:
- Perimeter entry: High security, audit trail, schedule-based
- Interior secured: Department access, group permissions
- High security: Two-factor, anti-passback

TYPICAL DOOR HARDWARE BUDGET:
- Basic interior: $1,500-2,500
- Exterior entry: $2,500-4,000
- High security: $4,000-8,000

LABOR STANDARDS (hours):
- Standard door (reader, REX, DPS): 3-4 hrs
- Door with electric strike: 4-5 hrs
- Door with mag lock: 4-5 hrs
- Wireless lock: 2-3 hrs
- System programming: 8-16 hrs
- Per door programming: 0.25-0.5 hrs

Provide door schedules, reader counts, controller sizing, and credential quantities.`
      },

      security: {
        id: 'security',
        name: 'Security/Intrusion Agent',
        icon: 'üîí',
        color: '#F59E0B',
        description: 'Commercial intrusion detection expert',
        specialty: 'Alarm Systems, Monitoring, Detection',
        prompt: `You are an expert in commercial intrusion detection and alarm systems.

EXPERT KNOWLEDGE:
- Control panels: Bosch B/G series, DMP, Honeywell Vista
- UL listings: UL 2050, UL 1076, UL 681
- Detection: PIR, dual-tech, glassbreak, contacts, shock sensors
- Communication: Cellular, IP, dual-path monitoring

DETECTION DEVICE SELECTION:
- PIR motion: Standard interior areas
- Dual-tech: High traffic, HVAC areas
- Glassbreak: Perimeter windows
- Door contacts: All entry points
- Shock sensors: High-value areas

LABOR STANDARDS (hours):
- Panel installation: 4-8 hrs
- Motion detector: 0.5 hrs
- Door contact: 0.5 hrs
- Glassbreak: 0.5 hrs
- Keypad: 1.0 hrs
- Programming: 4-8 hrs
- Testing per zone: 0.25 hrs

Provide zone schedules, device counts, and monitoring requirements.`
      },

      audioVisual: {
        id: 'audioVisual',
        name: 'Audio/Visual Agent',
        icon: 'üéµ',
        color: '#EC4899',
        description: 'CTS-D certified AV system designer',
        specialty: 'Audio, Video, Conference, Digital Signage',
        prompt: `You are a CTS-D (Certified Technology Specialist - Design) with expertise in commercial audio/visual systems.

EXPERT KNOWLEDGE:
- Distributed audio: 70V/100V systems, speaker calculations
- Sound reinforcement: DSP, amplifiers, speaker placement
- Video: Commercial displays, projectors, LED walls
- Conference: Zoom/Teams Rooms, ceiling mics, content sharing
- Control: Crestron, Extron, Atlona

AUDIO DESIGN:
- 70V transformer taps based on room size
- Speaker coverage: 1 per 100-150 SF typical
- Ceiling speaker: 8-12 ft spacing
- Amplifier sizing: Total wattage + 20% headroom

LABOR STANDARDS (hours):
- Ceiling speaker: 0.75 hrs
- Wall speaker: 1.0 hrs
- Amplifier: 2-4 hrs
- Display mount: 2-4 hrs
- Projector mount: 4-6 hrs
- Control programming: 8-24 hrs
- System commissioning: 4-8 hrs

Provide equipment lists, speaker layouts, and control system requirements.`
      },

      twoWay: {
        id: 'twoWay',
        name: '2-Way Comm Agent',
        icon: 'üìû',
        color: '#06B6D4',
        description: 'Area of Refuge and emergency comm specialist',
        specialty: 'IBC/ADA, Emergency Communication, Elevator',
        prompt: `You are a specialist in emergency communication systems, particularly Area of Refuge (AOR) and elevator emergency communication.

EXPERT KNOWLEDGE:
- IBC 1009.8: Areas of refuge require two-way communication
- ADA: Communication must be accessible
- NFPA 72: Signaling requirements
- ASME A17.1: Elevator emergency communication

SYSTEM COMPONENTS:
- Master station (command center)
- Call stations (AOR locations, elevator cabs)
- Zone controller/cabinet
- Power supply with battery backup
- Cellular or landline communicator
- ADA-compliant signage

MANUFACTURERS:
- Rath: 2100 series, 3300 series
- Cornell: 4800 series
- TalkAPhone, Code Blue, Viking

LABOR STANDARDS (hours):
- Master station: 4-8 hrs
- Call station (flush): 2-3 hrs
- Call station (surface): 1.5-2 hrs
- Zone cabinet: 4-6 hrs
- Cellular communicator: 2 hrs
- Programming per zone: 0.5 hrs
- Testing per station: 0.5 hrs

Provide zone layouts, station counts, and communication requirements.`
      },

      nurseCall: {
        id: 'nurseCall',
        name: 'Nurse Call Agent',
        icon: 'üè•',
        color: '#14B8A6',
        description: 'Healthcare communications specialist',
        specialty: 'UL 1069, Clinical Workflow, Integration',
        prompt: `You are a healthcare technology specialist with deep expertise in nurse call and clinical communication systems.

EXPERT KNOWLEDGE:
- UL 1069 (Hospital Signaling and Nurse Call)
- FGI Guidelines for healthcare facilities
- Joint Commission requirements
- Integration with EHR/ADT systems

MANUFACTURERS:
- Rauland (Ametek): Responder, Telecenter
- Jeron: Pro-Alert, Provider
- Critical Alert, Hill-Rom, TekTone

SYSTEM COMPONENTS:
- Master stations
- Patient stations (pillow speaker, wall mount)
- Staff stations
- Dome lights (corridor, zone)
- Code blue stations
- Bathroom pull cords
- Wireless pendants

LABOR STANDARDS (hours):
- Patient station: 1.5-2.0 hrs
- Bathroom station: 1.0 hrs
- Staff station: 1.0 hrs
- Dome light: 0.75 hrs
- Master station: 4-8 hrs
- Programming per bed: 0.5 hrs
- Testing per station: 0.25 hrs

Provide bed counts, station types, and dome light requirements.`
      },

      proposal: {
        id: 'proposal',
        name: 'Proposal Writer',
        icon: 'üìã',
        color: '#FFB81C',
        description: 'Technical writing and sales strategist',
        specialty: 'Scope Narratives, Value Propositions, Terms',
        prompt: `You are an expert technical writer and sales strategist specializing in low-voltage system proposals for 3D Technology Services.

WRITING STYLE:
- Professional and confident
- Solution-focused, customer-centric
- Active voice, specific quantities
- Lead with benefits, support with features

PROPOSAL STRUCTURE:
1. COVER LETTER: Greeting, understanding, value prop, CTA
2. EXECUTIVE SUMMARY: Overview, pricing table, differentiators
3. SCOPE OF WORK: System descriptions, components, compliance
4. PRICING: Line items, options, payment terms
5. CLARIFICATIONS: Assumptions, included/excluded, coordination
6. EXCLUSIONS: Not in scope, work by others
7. TERMS: Validity, payment, warranty, change orders

STANDARD EXCLUSIONS to consider:
- Performance/bid bonds
- Overtime/shift work
- Conduit, EMT, stub-ups, boxes (by EC)
- Cable tray, ladder rack (by EC)
- Fire stopping, sleeves
- 120V power
- Phone lines/monitoring
- Plywood, painting
- Equipment room HVAC
- Grounding/bonding (TGB/TBB)
- Core drilling
- As-builts, O&Ms
- Engineering stamps

Generate professional proposals that win bids while protecting against scope creep.`
      },

      budget: {
        id: 'budget',
        name: 'Budget Calculator',
        icon: 'üßÆ',
        color: '#17B2B2',
        description: 'Senior estimating and pricing manager',
        specialty: 'Labor Burden, Markup, Margins, Profitability',
        prompt: `You are a senior estimating manager responsible for ensuring accurate and profitable pricing.

CALCULATION FRAMEWORK:
- Labor: Base Rate √ó (1 + Burden) = Burdened Rate
- Labor Sell: Burdened Rate √ó Hours √ó (1 + Margin)
- Material: Cost √ó (1 + Tax) √ó (1 + Markup) = Sell

STANDARD LABOR RATES:
- Project Manager: $50/hr base, $110/hr sell
- CAD/Design: $40/hr base, $90/hr sell
- Warehouse: $25/hr base, $45/hr sell
- Admin: $25/hr base, $45/hr sell
- Installer: $40/hr base, $95/hr sell
- Technician: $45/hr base, $105/hr sell

BURDEN RATE: 55% (PT&I - Payroll, Taxes, Insurance)

STANDARD MARGINS BY SYSTEM:
- Fire Alarm: 30-40%
- Data/Cabling: 25-35%
- Security/CCTV: 30-40%
- Access Control: 30-40%
- Audio/Visual: 25-35%
- Nurse Call: 30-40%

ADJUSTMENTS:
- Design-build: +5-10%
- Competitive bid: -5-10%
- Prevailing wage: Factor into labor rate
- Complexity: +/-10-20%
- Risk: +5-15%

Generate detailed budget breakdowns with labor, material, and margin analysis.`
      }
    };

    // ============================================
    // MAIN APPLICATION COMPONENT
    // ============================================
    function TakeoffAI() {
      const [currentView, setCurrentView] = useState('home');
      const [uploadedFiles, setUploadedFiles] = useState([]);
      const [projectData, setProjectData] = useState(null);
      const [activeAgents, setActiveAgents] = useState([]);
      const [agentOutputs, setAgentOutputs] = useState({});
      const [isProcessing, setIsProcessing] = useState(false);
      const [processingStep, setProcessingStep] = useState('');
      const [apiKey, setApiKey] = useState('');
      const [showApiKeyModal, setShowApiKeyModal] = useState(false);
      const [chatHistory, setChatHistory] = useState([]);
      const [userInput, setUserInput] = useState('');
      const [selectedAgent, setSelectedAgent] = useState(null);
      const [projectInfo, setProjectInfo] = useState({
        name: '',
        address: '',
        city: '',
        customer: '',
        contact: '',
        dueDate: ''
      });

      // Load API key from localStorage
      useEffect(() => {
        const storedKey = localStorage.getItem('takeoff_ai_api_key');
        if (storedKey) setApiKey(storedKey);
      }, []);

      // Save API key to localStorage when updated
      useEffect(() => {
        if (apiKey) localStorage.setItem('takeoff_ai_api_key', apiKey);
      }, [apiKey]);

      // File upload handler
      const handleFileUpload = (e) => {
        const files = Array.from(e.target.files);
        setUploadedFiles(prev => [...prev, ...files.map(f => ({
          name: f.name,
          size: f.size,
          type: f.type,
          file: f,
          status: 'uploaded'
        }))]);
      };

      // Process documents with AI
      const processDocuments = async () => {
        if (!apiKey) {
          setShowApiKeyModal(true);
          return;
        }

        setIsProcessing(true);
        setCurrentView('processing');

        // Simulate processing steps
        const steps = [
          { step: 'Analyzing documents...', agent: 'orchestrator' },
          { step: 'Extracting project specifications...', agent: 'orchestrator' },
          { step: 'Identifying system requirements...', agent: 'orchestrator' },
          { step: 'Activating specialist agents...', agent: null }
        ];

        for (const s of steps) {
          setProcessingStep(s.step);
          await new Promise(r => setTimeout(r, 1500));
        }

        // Determine which agents to activate based on mock analysis
        const detectedSystems = ['dataCabling', 'cctv', 'accessControl', 'twoWay', 'audioVisual'];
        setActiveAgents(detectedSystems);

        // Process each agent
        for (const agentId of detectedSystems) {
          setProcessingStep(`${AGENTS[agentId].name} analyzing scope...`);
          await new Promise(r => setTimeout(r, 2000));

          // Mock output for demo - in production this would call Claude API
          setAgentOutputs(prev => ({
            ...prev,
            [agentId]: {
              status: 'complete',
              summary: `Analysis complete for ${AGENTS[agentId].specialty}`,
              timestamp: new Date().toISOString()
            }
          }));
        }

        setProcessingStep('Generating deliverables...');
        await new Promise(r => setTimeout(r, 1500));

        setIsProcessing(false);
        setCurrentView('dashboard');
      };

      // Call Claude API
      const callClaudeAPI = async (agentId, userMessage) => {
        const agent = AGENTS[agentId];

        try {
          const response = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'x-api-key': apiKey.trim(),
              'anthropic-version': '2023-06-01',
              'anthropic-dangerous-direct-browser-access': 'true'
            },
            body: JSON.stringify({
              model: 'claude-opus-4-5-20251124', // Updated to best available model
              max_tokens: 4096,
              system: agent.prompt,
              messages: [
                ...chatHistory.map(m => ({
                  role: m.role,
                  content: m.content
                })),
                { role: 'user', content: userMessage }
              ]
            })
          });

          const data = await response.json();

          if (!response.ok) {
            console.error('API Error Response:', data);
            throw new Error(data.error?.message || `API Error: ${response.status}`);
          }

          if (!data.content || !data.content[0] || !data.content[0].text) {
            console.error('Unexpected API Response Structure:', data);
            throw new Error('Received invalid response from AI provider');
          }

          return data.content[0].text;
        } catch (error) {
          console.error('API Call Failed:', error);
          return `Error communicating with ${agent.name}: ${error.message}. Please check your API key and network connection.`;
        }
      };

      // Send message to agent
      const sendMessage = async () => {
        if (!userInput.trim() || !selectedAgent) return;
        if (!apiKey) {
          setShowApiKeyModal(true);
          return;
        }

        const userMessage = userInput;
        setUserInput('');

        setChatHistory(prev => [...prev, {
          role: 'user',
          content: userMessage,
          timestamp: new Date().toISOString()
        }]);

        setIsProcessing(true);
        const response = await callClaudeAPI(selectedAgent, userMessage);
        setIsProcessing(false);

        setChatHistory(prev => [...prev, {
          role: 'assistant',
          content: response,
          agent: selectedAgent,
          timestamp: new Date().toISOString()
        }]);
      };

      // ============================================
      // RENDER COMPONENTS
      // ============================================

      // Header Component
      const Header = () => (
        <header style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          height: '70px',
          background: 'rgba(10, 15, 28, 0.95)',
          backdropFilter: 'blur(20px)',
          borderBottom: '1px solid rgba(255, 184, 28, 0.2)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'space-between',
          padding: '0 40px',
          zIndex: 1000
        }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
            <div style={{
              width: '45px',
              height: '45px',
              background: 'var(--gradient-gold)',
              borderRadius: '12px',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              fontSize: '24px',
              boxShadow: 'var(--shadow-glow-gold)'
            }}>
              ‚ö°
            </div>
            <div>
              <h1 style={{
                fontSize: '22px',
                fontWeight: '800',
                background: 'linear-gradient(135deg, #FFB81C 0%, #FFD470 100%)',
                WebkitBackgroundClip: 'text',
                WebkitTextFillColor: 'transparent',
                letterSpacing: '-0.5px'
              }}>
                TakeoffAI
              </h1>
              <p style={{ fontSize: '11px', color: 'var(--text-muted)', letterSpacing: '2px', textTransform: 'uppercase' }}>
                3D Technology Services
              </p>
            </div>
          </div>

          <nav style={{ display: 'flex', gap: '8px' }}>
            {['home', 'dashboard', 'agents', 'settings'].map(view => (
              <button
                key={view}
                onClick={() => setCurrentView(view)}
                style={{
                  padding: '10px 20px',
                  background: currentView === view ? 'rgba(255, 184, 28, 0.15)' : 'transparent',
                  border: currentView === view ? '1px solid rgba(255, 184, 28, 0.3)' : '1px solid transparent',
                  borderRadius: '8px',
                  color: currentView === view ? 'var(--gold)' : 'var(--text-secondary)',
                  fontSize: '14px',
                  fontWeight: '500',
                  cursor: 'pointer',
                  transition: 'all 0.3s ease',
                  textTransform: 'capitalize'
                }}
              >
                {view}
              </button>
            ))}
          </nav>

          <button
            onClick={() => setShowApiKeyModal(true)}
            style={{
              padding: '10px 20px',
              background: apiKey ? 'rgba(16, 185, 129, 0.15)' : 'rgba(239, 68, 68, 0.15)',
              border: `1px solid ${apiKey ? 'rgba(16, 185, 129, 0.3)' : 'rgba(239, 68, 68, 0.3)'}`,
              borderRadius: '8px',
              color: apiKey ? 'var(--success)' : 'var(--error)',
              fontSize: '13px',
              fontWeight: '500',
              cursor: 'pointer',
              display: 'flex',
              alignItems: 'center',
              gap: '8px'
            }}
          >
            {apiKey ? 'üîë API Connected' : '‚ö†Ô∏è Set API Key'}
          </button>
        </header>
      );

      // Home View
      const HomeView = () => (
        <div style={{ paddingTop: '70px', minHeight: '100vh' }}>
          {/* Hero Section */}
          <section style={{
            padding: '80px 40px',
            textAlign: 'center',
            position: 'relative'
          }}>
            <div className="animate-fade-in-up">
              <div style={{
                display: 'inline-flex',
                alignItems: 'center',
                gap: '8px',
                padding: '8px 16px',
                background: 'rgba(255, 184, 28, 0.1)',
                border: '1px solid rgba(255, 184, 28, 0.2)',
                borderRadius: '100px',
                marginBottom: '24px'
              }}>
                <span style={{ fontSize: '14px' }}>üöÄ</span>
                <span style={{ fontSize: '13px', color: 'var(--gold)', fontWeight: '500' }}>
                  Powered by Claude AI
                </span>
              </div>
            </div>

            <h1 className="animate-fade-in-up delay-1" style={{
              fontSize: 'clamp(40px, 6vw, 72px)',
              fontWeight: '900',
              lineHeight: '1.1',
              marginBottom: '24px',
              letterSpacing: '-2px'
            }}>
              Transform Plans into
              <br />
              <span style={{
                background: 'linear-gradient(135deg, #FFB81C 0%, #17B2B2 100%)',
                WebkitBackgroundClip: 'text',
                WebkitTextFillColor: 'transparent'
              }}>
                Professional Proposals
              </span>
            </h1>

            <p className="animate-fade-in-up delay-2" style={{
              fontSize: '20px',
              color: 'var(--text-secondary)',
              maxWidth: '600px',
              margin: '0 auto 48px',
              lineHeight: '1.6'
            }}>
              Upload your project documents and let our AI agents analyze, design,
              and generate complete low-voltage system takeoffs in minutes.
            </p>

            {/* Upload Area */}
            <div className="animate-fade-in-up delay-3" style={{
              maxWidth: '800px',
              margin: '0 auto'
            }}>
              <label style={{
                display: 'block',
                padding: '60px 40px',
                background: 'linear-gradient(135deg, rgba(255, 184, 28, 0.05) 0%, rgba(23, 178, 178, 0.05) 100%)',
                border: '2px dashed rgba(255, 184, 28, 0.3)',
                borderRadius: '20px',
                cursor: 'pointer',
                transition: 'all 0.3s ease'
              }}>
                <input
                  type="file"
                  multiple
                  accept=".pdf,.xlsx,.xls,.doc,.docx,.txt"
                  onChange={handleFileUpload}
                  style={{ display: 'none' }}
                />
                <div style={{ fontSize: '48px', marginBottom: '16px' }}>üìÅ</div>
                <p style={{ fontSize: '18px', fontWeight: '600', marginBottom: '8px' }}>
                  Drop your project files here
                </p>
                <p style={{ fontSize: '14px', color: 'var(--text-muted)' }}>
                  PDF plans, specs, Excel scopes, RFPs ‚Ä¢ Multiple files supported
                </p>
              </label>

              {/* Uploaded Files */}
              {uploadedFiles.length > 0 && (
                <div style={{
                  marginTop: '24px',
                  background: 'var(--bg-card)',
                  borderRadius: '16px',
                  padding: '20px',
                  border: '1px solid var(--border)'
                }}>
                  <h3 style={{ fontSize: '14px', fontWeight: '600', marginBottom: '16px', color: 'var(--text-secondary)' }}>
                    Uploaded Files ({uploadedFiles.length})
                  </h3>
                  {uploadedFiles.map((file, i) => (
                    <div key={i} style={{
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'space-between',
                      padding: '12px 16px',
                      background: 'var(--bg-secondary)',
                      borderRadius: '8px',
                      marginBottom: '8px'
                    }}>
                      <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                        <span style={{ fontSize: '20px' }}>
                          {file.name.endsWith('.pdf') ? 'üìÑ' : file.name.endsWith('.xlsx') ? 'üìä' : 'üìÅ'}
                        </span>
                        <span style={{ fontSize: '14px' }}>{file.name}</span>
                      </div>
                      <span style={{ fontSize: '12px', color: 'var(--success)' }}>‚úì Ready</span>
                    </div>
                  ))}
                </div>
              )}

              {/* Project Info */}
              {uploadedFiles.length > 0 && (
                <div style={{
                  marginTop: '24px',
                  background: 'var(--bg-card)',
                  borderRadius: '16px',
                  padding: '24px',
                  border: '1px solid var(--border)'
                }}>
                  <h3 style={{ fontSize: '16px', fontWeight: '600', marginBottom: '20px' }}>
                    Project Information
                  </h3>
                  <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '16px' }}>
                    {[
                      { key: 'name', label: 'Project Name', placeholder: 'The Ivy Danville' },
                      { key: 'customer', label: 'Customer', placeholder: 'CSI Construction' },
                      { key: 'address', label: 'Address', placeholder: '123 Main Street' },
                      { key: 'city', label: 'City, State', placeholder: 'Danville, CA' },
                      { key: 'contact', label: 'Contact Name', placeholder: 'Luis Alvarez' },
                      { key: 'dueDate', label: 'Bid Due Date', placeholder: 'MM/DD/YYYY' }
                    ].map(field => (
                      <div key={field.key}>
                        <label style={{ fontSize: '12px', color: 'var(--text-muted)', marginBottom: '6px', display: 'block' }}>
                          {field.label}
                        </label>
                        <input
                          type="text"
                          placeholder={field.placeholder}
                          value={projectInfo[field.key]}
                          onChange={e => setProjectInfo(prev => ({ ...prev, [field.key]: e.target.value }))}
                          style={{
                            width: '100%',
                            padding: '12px 16px',
                            background: 'var(--bg-secondary)',
                            border: '1px solid var(--border)',
                            borderRadius: '8px',
                            color: 'var(--text-primary)',
                            fontSize: '14px'
                          }}
                        />
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {/* Process Button */}
              {uploadedFiles.length > 0 && (
                <button
                  onClick={processDocuments}
                  style={{
                    marginTop: '32px',
                    padding: '18px 48px',
                    background: 'var(--gradient-gold)',
                    border: 'none',
                    borderRadius: '12px',
                    color: '#000',
                    fontSize: '16px',
                    fontWeight: '700',
                    cursor: 'pointer',
                    boxShadow: 'var(--shadow-glow-gold)',
                    transition: 'all 0.3s ease'
                  }}
                >
                  üöÄ Launch AI Analysis
                </button>
              )}
            </div>
          </section>

          {/* Agents Preview */}
          <section style={{ padding: '60px 40px', background: 'var(--bg-secondary)' }}>
            <h2 style={{
              textAlign: 'center',
              fontSize: '32px',
              fontWeight: '700',
              marginBottom: '48px'
            }}>
              Meet Your AI Agents
            </h2>
            <div style={{
              display: 'grid',
              gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))',
              gap: '20px',
              maxWidth: '1400px',
              margin: '0 auto'
            }}>
              {Object.values(AGENTS).map(agent => (
                <div
                  key={agent.id}
                  style={{
                    background: 'var(--bg-card)',
                    borderRadius: '16px',
                    padding: '24px',
                    border: `1px solid ${agent.color}33`,
                    transition: 'all 0.3s ease',
                    cursor: 'pointer'
                  }}
                  onMouseEnter={e => {
                    e.currentTarget.style.transform = 'translateY(-4px)';
                    e.currentTarget.style.boxShadow = `0 10px 40px ${agent.color}22`;
                  }}
                  onMouseLeave={e => {
                    e.currentTarget.style.transform = 'translateY(0)';
                    e.currentTarget.style.boxShadow = 'none';
                  }}
                >
                  <div style={{
                    width: '50px',
                    height: '50px',
                    background: `${agent.color}22`,
                    borderRadius: '12px',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    fontSize: '24px',
                    marginBottom: '16px'
                  }}>
                    {agent.icon}
                  </div>
                  <h3 style={{ fontSize: '18px', fontWeight: '600', marginBottom: '8px' }}>
                    {agent.name}
                  </h3>
                  <p style={{ fontSize: '13px', color: agent.color, marginBottom: '8px', fontWeight: '500' }}>
                    {agent.specialty}
                  </p>
                  <p style={{ fontSize: '13px', color: 'var(--text-muted)', lineHeight: '1.5' }}>
                    {agent.description}
                  </p>
                </div>
              ))}
            </div>
          </section>
        </div>
      );

      // Processing View
      const ProcessingView = () => (
        <div style={{
          paddingTop: '70px',
          minHeight: '100vh',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center'
        }}>
          <div style={{ textAlign: 'center', maxWidth: '600px' }}>
            <div style={{
              width: '120px',
              height: '120px',
              margin: '0 auto 32px',
              position: 'relative'
            }}>
              <div style={{
                position: 'absolute',
                inset: 0,
                border: '3px solid var(--border)',
                borderTopColor: 'var(--gold)',
                borderRadius: '50%',
                animation: 'spin 1s linear infinite'
              }} />
              <div style={{
                position: 'absolute',
                inset: '15px',
                border: '3px solid var(--border)',
                borderTopColor: 'var(--teal)',
                borderRadius: '50%',
                animation: 'spin 1.5s linear infinite reverse'
              }} />
              <div style={{
                position: 'absolute',
                inset: 0,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                fontSize: '32px'
              }}>
                ‚ö°
              </div>
            </div>

            <h2 style={{ fontSize: '28px', fontWeight: '700', marginBottom: '16px' }}>
              AI Agents Working
            </h2>
            <p style={{
              fontSize: '18px',
              color: 'var(--gold)',
              fontFamily: 'JetBrains Mono',
              marginBottom: '32px'
            }}>
              {processingStep}
            </p>

            {/* Active Agents */}
            <div style={{
              display: 'flex',
              flexWrap: 'wrap',
              gap: '12px',
              justifyContent: 'center'
            }}>
              {activeAgents.map(agentId => {
                const agent = AGENTS[agentId];
                const output = agentOutputs[agentId];
                return (
                  <div
                    key={agentId}
                    style={{
                      padding: '12px 20px',
                      background: output?.status === 'complete'
                        ? 'rgba(16, 185, 129, 0.15)'
                        : 'rgba(255, 184, 28, 0.15)',
                      border: `1px solid ${output?.status === 'complete' ? 'var(--success)' : 'var(--gold)'}`,
                      borderRadius: '100px',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px'
                    }}
                  >
                    <span>{agent.icon}</span>
                    <span style={{ fontSize: '13px', fontWeight: '500' }}>{agent.name}</span>
                    {output?.status === 'complete' && <span>‚úì</span>}
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      );

      // Dashboard View
      const DashboardView = () => (
        <div style={{ paddingTop: '90px', padding: '90px 40px 40px' }}>
          <div style={{ maxWidth: '1600px', margin: '0 auto' }}>
            {/* Dashboard Header */}
            <div style={{
              display: 'flex',
              justifyContent: 'space-between',
              alignItems: 'center',
              marginBottom: '32px'
            }}>
              <div>
                <h1 style={{ fontSize: '32px', fontWeight: '700', marginBottom: '8px' }}>
                  {projectInfo.name || 'Project Dashboard'}
                </h1>
                <p style={{ color: 'var(--text-muted)' }}>
                  {projectInfo.city || 'Location'} ‚Ä¢ {projectInfo.customer || 'Customer'}
                </p>
              </div>
              <div style={{ display: 'flex', gap: '12px' }}>
                <button style={{
                  padding: '12px 24px',
                  background: 'var(--bg-card)',
                  border: '1px solid var(--border)',
                  borderRadius: '8px',
                  color: 'var(--text-primary)',
                  fontSize: '14px',
                  fontWeight: '500',
                  cursor: 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px'
                }}>
                  üìä Export Excel
                </button>
                <button style={{
                  padding: '12px 24px',
                  background: 'var(--gradient-gold)',
                  border: 'none',
                  borderRadius: '8px',
                  color: '#000',
                  fontSize: '14px',
                  fontWeight: '600',
                  cursor: 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px'
                }}>
                  üìã Generate Proposal
                </button>
              </div>
            </div>

            {/* Summary Cards */}
            <div style={{
              display: 'grid',
              gridTemplateColumns: 'repeat(4, 1fr)',
              gap: '20px',
              marginBottom: '32px'
            }}>
              {[
                { label: 'Total Systems', value: activeAgents.length, icon: 'üîß', color: 'var(--gold)' },
                { label: 'Material Cost', value: '$286,450', icon: 'üì¶', color: 'var(--teal)' },
                { label: 'Labor Hours', value: '2,847', icon: '‚è±Ô∏è', color: 'var(--success)' },
                { label: 'Project Total', value: '$415,773', icon: 'üí∞', color: '#EC4899' }
              ].map((card, i) => (
                <div key={i} style={{
                  background: 'var(--bg-card)',
                  borderRadius: '16px',
                  padding: '24px',
                  border: '1px solid var(--border)'
                }}>
                  <div style={{
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'flex-start',
                    marginBottom: '16px'
                  }}>
                    <span style={{ fontSize: '14px', color: 'var(--text-muted)' }}>{card.label}</span>
                    <span style={{ fontSize: '24px' }}>{card.icon}</span>
                  </div>
                  <div style={{ fontSize: '32px', fontWeight: '700', color: card.color }}>
                    {card.value}
                  </div>
                </div>
              ))}
            </div>

            {/* Systems Grid */}
            <div style={{
              display: 'grid',
              gridTemplateColumns: 'repeat(2, 1fr)',
              gap: '20px'
            }}>
              {activeAgents.map(agentId => {
                const agent = AGENTS[agentId];
                return (
                  <div key={agentId} style={{
                    background: 'var(--bg-card)',
                    borderRadius: '16px',
                    padding: '24px',
                    border: '1px solid var(--border)'
                  }}>
                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '12px',
                      marginBottom: '20px'
                    }}>
                      <div style={{
                        width: '44px',
                        height: '44px',
                        background: `${agent.color}22`,
                        borderRadius: '10px',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        fontSize: '20px'
                      }}>
                        {agent.icon}
                      </div>
                      <div>
                        <h3 style={{ fontSize: '16px', fontWeight: '600' }}>{agent.name}</h3>
                        <p style={{ fontSize: '12px', color: agent.color }}>{agent.specialty}</p>
                      </div>
                      <div style={{
                        marginLeft: 'auto',
                        padding: '6px 12px',
                        background: 'rgba(16, 185, 129, 0.15)',
                        borderRadius: '100px',
                        fontSize: '12px',
                        color: 'var(--success)'
                      }}>
                        ‚úì Complete
                      </div>
                    </div>

                    <div style={{
                      display: 'grid',
                      gridTemplateColumns: 'repeat(3, 1fr)',
                      gap: '16px',
                      padding: '16px',
                      background: 'var(--bg-secondary)',
                      borderRadius: '12px'
                    }}>
                      <div>
                        <div style={{ fontSize: '12px', color: 'var(--text-muted)', marginBottom: '4px' }}>Devices</div>
                        <div style={{ fontSize: '18px', fontWeight: '600' }}>
                          {Math.floor(Math.random() * 100) + 20}
                        </div>
                      </div>
                      <div>
                        <div style={{ fontSize: '12px', color: 'var(--text-muted)', marginBottom: '4px' }}>Material</div>
                        <div style={{ fontSize: '18px', fontWeight: '600' }}>
                          ${(Math.floor(Math.random() * 80) + 20).toLocaleString()}k
                        </div>
                      </div>
                      <div>
                        <div style={{ fontSize: '12px', color: 'var(--text-muted)', marginBottom: '4px' }}>Hours</div>
                        <div style={{ fontSize: '18px', fontWeight: '600' }}>
                          {Math.floor(Math.random() * 500) + 100}
                        </div>
                      </div>
                    </div>

                    <button
                      onClick={() => {
                        setSelectedAgent(agentId);
                        setChatHistory([]);
                        setCurrentView('chat');
                      }}
                      style={{
                        width: '100%',
                        marginTop: '16px',
                        padding: '12px',
                        background: 'transparent',
                        border: `1px solid ${agent.color}44`,
                        borderRadius: '8px',
                        color: agent.color,
                        fontSize: '14px',
                        fontWeight: '500',
                        cursor: 'pointer',
                        transition: 'all 0.3s ease'
                      }}
                    >
                      üí¨ Chat with Agent
                    </button>
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      );

      // Agents View
      const AgentsView = () => (
        <div style={{ paddingTop: '90px', padding: '90px 40px 40px' }}>
          <div style={{ maxWidth: '1400px', margin: '0 auto' }}>
            <h1 style={{ fontSize: '32px', fontWeight: '700', marginBottom: '8px' }}>
              AI Agent Hub
            </h1>
            <p style={{ color: 'var(--text-muted)', marginBottom: '32px' }}>
              Select an agent to start a conversation or view their capabilities
            </p>

            <div style={{
              display: 'grid',
              gridTemplateColumns: 'repeat(auto-fit, minmax(350px, 1fr))',
              gap: '20px'
            }}>
              {Object.values(AGENTS).map(agent => (
                <div
                  key={agent.id}
                  onClick={() => {
                    setSelectedAgent(agent.id);
                    setChatHistory([]);
                    setCurrentView('chat');
                  }}
                  style={{
                    background: 'var(--bg-card)',
                    borderRadius: '16px',
                    padding: '28px',
                    border: `1px solid ${agent.color}33`,
                    cursor: 'pointer',
                    transition: 'all 0.3s ease'
                  }}
                  onMouseEnter={e => {
                    e.currentTarget.style.transform = 'translateY(-4px)';
                    e.currentTarget.style.borderColor = agent.color;
                    e.currentTarget.style.boxShadow = `0 10px 40px ${agent.color}22`;
                  }}
                  onMouseLeave={e => {
                    e.currentTarget.style.transform = 'translateY(0)';
                    e.currentTarget.style.borderColor = `${agent.color}33`;
                    e.currentTarget.style.boxShadow = 'none';
                  }}
                >
                  <div style={{
                    display: 'flex',
                    alignItems: 'flex-start',
                    gap: '16px',
                    marginBottom: '16px'
                  }}>
                    <div style={{
                      width: '56px',
                      height: '56px',
                      background: `${agent.color}22`,
                      borderRadius: '14px',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      fontSize: '28px',
                      flexShrink: 0
                    }}>
                      {agent.icon}
                    </div>
                    <div>
                      <h3 style={{ fontSize: '20px', fontWeight: '600', marginBottom: '4px' }}>
                        {agent.name}
                      </h3>
                      <p style={{ fontSize: '14px', color: agent.color, fontWeight: '500' }}>
                        {agent.specialty}
                      </p>
                    </div>
                  </div>

                  <p style={{
                    fontSize: '14px',
                    color: 'var(--text-secondary)',
                    lineHeight: '1.6',
                    marginBottom: '16px'
                  }}>
                    {agent.description}
                  </p>

                  <div style={{
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'space-between',
                    paddingTop: '16px',
                    borderTop: '1px solid var(--border)'
                  }}>
                    <span style={{
                      fontSize: '13px',
                      color: 'var(--text-muted)',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '6px'
                    }}>
                      <span style={{ color: 'var(--success)' }}>‚óè</span> Ready
                    </span>
                    <span style={{
                      fontSize: '13px',
                      color: agent.color,
                      fontWeight: '500'
                    }}>
                      Start Chat ‚Üí
                    </span>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      );

      // Chat View
      const ChatView = () => {
        const agent = AGENTS[selectedAgent];
        const chatEndRef = useRef(null);

        useEffect(() => {
          chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
        }, [chatHistory]);

        if (!agent) return null;

        return (
          <div style={{
            paddingTop: '70px',
            height: '100vh',
            display: 'flex',
            flexDirection: 'column'
          }}>
            {/* Chat Header */}
            <div style={{
              padding: '20px 40px',
              background: 'var(--bg-secondary)',
              borderBottom: '1px solid var(--border)',
              display: 'flex',
              alignItems: 'center',
              gap: '16px'
            }}>
              <button
                onClick={() => setCurrentView('agents')}
                style={{
                  padding: '8px 16px',
                  background: 'var(--bg-tertiary)',
                  border: '1px solid var(--border)',
                  borderRadius: '8px',
                  color: 'var(--text-secondary)',
                  fontSize: '14px',
                  cursor: 'pointer'
                }}
              >
                ‚Üê Back
              </button>
              <div style={{
                width: '44px',
                height: '44px',
                background: `${agent.color}22`,
                borderRadius: '12px',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                fontSize: '22px'
              }}>
                {agent.icon}
              </div>
              <div>
                <h2 style={{ fontSize: '18px', fontWeight: '600' }}>{agent.name}</h2>
                <p style={{ fontSize: '13px', color: agent.color }}>{agent.specialty}</p>
              </div>
            </div>

            {/* Chat Messages */}
            <div style={{
              flex: 1,
              overflow: 'auto',
              padding: '24px 40px'
            }}>
              {chatHistory.length === 0 && (
                <div style={{
                  textAlign: 'center',
                  padding: '60px 20px',
                  color: 'var(--text-muted)'
                }}>
                  <div style={{ fontSize: '48px', marginBottom: '16px' }}>{agent.icon}</div>
                  <h3 style={{ fontSize: '20px', fontWeight: '600', marginBottom: '8px', color: 'var(--text-primary)' }}>
                    Start a conversation with {agent.name}
                  </h3>
                  <p style={{ fontSize: '14px', maxWidth: '500px', margin: '0 auto' }}>
                    Ask about system design, material selections, labor estimates, code requirements,
                    or anything related to {agent.specialty.toLowerCase()}.
                  </p>
                </div>
              )}

              {chatHistory.map((msg, i) => (
                <div
                  key={i}
                  style={{
                    display: 'flex',
                    justifyContent: msg.role === 'user' ? 'flex-end' : 'flex-start',
                    marginBottom: '16px'
                  }}
                >
                  <div style={{
                    maxWidth: '80%',
                    padding: '16px 20px',
                    background: msg.role === 'user' ? 'var(--gradient-gold)' : 'var(--bg-card)',
                    color: msg.role === 'user' ? '#000' : 'var(--text-primary)',
                    borderRadius: '16px',
                    borderBottomRightRadius: msg.role === 'user' ? '4px' : '16px',
                    borderBottomLeftRadius: msg.role === 'user' ? '16px' : '4px',
                    border: msg.role === 'user' ? 'none' : '1px solid var(--border)'
                  }}>
                    <div style={{
                      fontSize: '14px',
                      lineHeight: '1.6',
                      whiteSpace: 'pre-wrap'
                    }}>
                      {msg.content}
                    </div>
                  </div>
                </div>
              ))}

              {isProcessing && (
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  gap: '12px',
                  padding: '16px 20px',
                  background: 'var(--bg-card)',
                  borderRadius: '16px',
                  width: 'fit-content'
                }}>
                  <div style={{
                    width: '8px',
                    height: '8px',
                    background: agent.color,
                    borderRadius: '50%',
                    animation: 'pulse 1s infinite'
                  }} />
                  <span style={{ color: 'var(--text-muted)', fontSize: '14px' }}>
                    {agent.name} is thinking...
                  </span>
                </div>
              )}

              <div ref={chatEndRef} />
            </div>

            {/* Chat Input */}
            <div style={{
              padding: '20px 40px',
              background: 'var(--bg-secondary)',
              borderTop: '1px solid var(--border)'
            }}>
              <div style={{
                display: 'flex',
                gap: '12px',
                maxWidth: '1200px',
                margin: '0 auto'
              }}>
                <input
                  type="text"
                  value={userInput}
                  onChange={e => setUserInput(e.target.value)}
                  onKeyPress={e => e.key === 'Enter' && sendMessage()}
                  placeholder={`Ask ${agent.name} anything...`}
                  style={{
                    flex: 1,
                    padding: '16px 20px',
                    background: 'var(--bg-tertiary)',
                    border: '1px solid var(--border)',
                    borderRadius: '12px',
                    color: 'var(--text-primary)',
                    fontSize: '15px'
                  }}
                />
                <button
                  onClick={sendMessage}
                  disabled={isProcessing || !userInput.trim()}
                  style={{
                    padding: '16px 32px',
                    background: isProcessing ? 'var(--bg-tertiary)' : 'var(--gradient-gold)',
                    border: 'none',
                    borderRadius: '12px',
                    color: isProcessing ? 'var(--text-muted)' : '#000',
                    fontSize: '15px',
                    fontWeight: '600',
                    cursor: isProcessing ? 'not-allowed' : 'pointer'
                  }}
                >
                  Send
                </button>
              </div>
            </div>
          </div>
        );
      };

      // Settings View
      const SettingsView = () => (
        <div style={{ paddingTop: '90px', padding: '90px 40px 40px' }}>
          <div style={{ maxWidth: '800px', margin: '0 auto' }}>
            <h1 style={{ fontSize: '32px', fontWeight: '700', marginBottom: '32px' }}>
              Settings
            </h1>

            <div style={{
              background: 'var(--bg-card)',
              borderRadius: '16px',
              padding: '28px',
              border: '1px solid var(--border)',
              marginBottom: '20px'
            }}>
              <h3 style={{ fontSize: '18px', fontWeight: '600', marginBottom: '8px' }}>
                Claude API Key
              </h3>
              <p style={{ fontSize: '14px', color: 'var(--text-muted)', marginBottom: '16px' }}>
                Enter your Anthropic API key to enable AI agent functionality
              </p>
              <div style={{ display: 'flex', gap: '12px' }}>
                <input
                  type="password"
                  value={apiKey}
                  onChange={e => setApiKey(e.target.value)}
                  placeholder="sk-ant-..."
                  style={{
                    flex: 1,
                    padding: '14px 18px',
                    background: 'var(--bg-secondary)',
                    border: '1px solid var(--border)',
                    borderRadius: '10px',
                    color: 'var(--text-primary)',
                    fontSize: '14px',
                    fontFamily: 'JetBrains Mono'
                  }}
                />
                <button
                  onClick={() => setShowApiKeyModal(false)}
                  style={{
                    padding: '14px 24px',
                    background: 'var(--gradient-teal)',
                    border: 'none',
                    borderRadius: '10px',
                    color: '#fff',
                    fontSize: '14px',
                    fontWeight: '600',
                    cursor: 'pointer'
                  }}
                >
                  Save
                </button>
              </div>
            </div>

            <div style={{
              background: 'var(--bg-card)',
              borderRadius: '16px',
              padding: '28px',
              border: '1px solid var(--border)'
            }}>
              <h3 style={{ fontSize: '18px', fontWeight: '600', marginBottom: '8px' }}>
                Company Information
              </h3>
              <p style={{ fontSize: '14px', color: 'var(--text-muted)', marginBottom: '16px' }}>
                This information will be used in generated proposals
              </p>
              <div style={{ display: 'grid', gap: '16px' }}>
                <input
                  type="text"
                  defaultValue="3D Technology Services"
                  placeholder="Company Name"
                  style={{
                    padding: '14px 18px',
                    background: 'var(--bg-secondary)',
                    border: '1px solid var(--border)',
                    borderRadius: '10px',
                    color: 'var(--text-primary)',
                    fontSize: '14px'
                  }}
                />
                <input
                  type="text"
                  defaultValue="11365 Sunrise Gold Circle, Rancho Cordova, CA 95742"
                  placeholder="Address"
                  style={{
                    padding: '14px 18px',
                    background: 'var(--bg-secondary)',
                    border: '1px solid var(--border)',
                    borderRadius: '10px',
                    color: 'var(--text-primary)',
                    fontSize: '14px'
                  }}
                />
              </div>
            </div>
          </div>
        </div>
      );

      // API Key Modal
      const ApiKeyModal = () => (
        <div style={{
          position: 'fixed',
          inset: 0,
          background: 'rgba(0, 0, 0, 0.8)',
          backdropFilter: 'blur(10px)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          zIndex: 2000
        }}>
          <div style={{
            background: 'var(--bg-card)',
            borderRadius: '20px',
            padding: '32px',
            width: '100%',
            maxWidth: '500px',
            border: '1px solid var(--border)'
          }}>
            <h2 style={{ fontSize: '24px', fontWeight: '700', marginBottom: '8px' }}>
              üîë API Key Required
            </h2>
            <p style={{ fontSize: '14px', color: 'var(--text-muted)', marginBottom: '24px' }}>
              Enter your Anthropic API key to enable AI-powered analysis.
              Your key is stored locally and never sent to our servers.
            </p>
            <input
              type="password"
              value={apiKey}
              onChange={e => setApiKey(e.target.value)}
              placeholder="sk-ant-api03-..."
              style={{
                width: '100%',
                padding: '16px 20px',
                background: 'var(--bg-secondary)',
                border: '1px solid var(--border)',
                borderRadius: '12px',
                color: 'var(--text-primary)',
                fontSize: '15px',
                fontFamily: 'JetBrains Mono',
                marginBottom: '20px'
              }}
            />
            <div style={{ display: 'flex', gap: '12px' }}>
              <button
                onClick={() => setShowApiKeyModal(false)}
                style={{
                  flex: 1,
                  padding: '14px',
                  background: 'var(--bg-tertiary)',
                  border: '1px solid var(--border)',
                  borderRadius: '10px',
                  color: 'var(--text-secondary)',
                  fontSize: '14px',
                  fontWeight: '500',
                  cursor: 'pointer'
                }}
              >
                Cancel
              </button>
              <button
                onClick={() => setShowApiKeyModal(false)}
                style={{
                  flex: 1,
                  padding: '14px',
                  background: 'var(--gradient-gold)',
                  border: 'none',
                  borderRadius: '10px',
                  color: '#000',
                  fontSize: '14px',
                  fontWeight: '600',
                  cursor: 'pointer'
                }}
              >
                Save Key
              </button>
            </div>
          </div>
        </div>
      );

      // Main Render
      return (
        <>
          <Header />

          {currentView === 'home' && <HomeView />}
          {currentView === 'processing' && <ProcessingView />}
          {currentView === 'dashboard' && <DashboardView />}
          {currentView === 'agents' && <AgentsView />}
          {currentView === 'chat' && <ChatView />}
          {currentView === 'settings' && <SettingsView />}

          {showApiKeyModal && <ApiKeyModal />}
        </>
      );
    }

    // Render App
    ReactDOM.render(<TakeoffAI />, document.getElementById('root'));
  </script>
</body>

</html>